<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Multiplayer Bingo</title>

<style>
body {
  margin: 0;
  height: 100vh;
  background: #0f172a;
  color: white;
  font-family: system-ui, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
}

.game {
  text-align: center;
}

.board {
  display: grid;
  grid-template-columns: repeat(5, 70px);
  gap: 8px;
  margin: 20px auto;
}

.cell {
  background: #1e293b;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  cursor: pointer;
  border-radius: 8px;
  user-select: none;
}

.cell.marked {
  background: #334155;
  text-decoration: line-through;
}

.status {
  margin-top: 10px;
  min-height: 24px;
}
</style>
</head>
<body>

<div class="game">
  <h1>BINGO</h1>
  <div id="board" class="board"></div>
  <div id="status" class="status">Connectingâ€¦</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ========= FIREBASE CONFIG ========= */
/* Replace ALL values */

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCT6Cu6UCcQzsxUOTHCskTzXCCMsmSDzFU",
  authDomain: "realtime-tic-tac-toe-98cfc.firebaseapp.com",
  projectId: "realtime-tic-tac-toe-98cfc",
  storageBucket: "realtime-tic-tac-toe-98cfc.firebasestorage.app",
  messagingSenderId: "621024160507",
  appId: "1:621024160507:web:0dc7713e199bd4d8d71e5e",
  measurementId: "G-TG3JHTFNXH"
};;

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
console.log("Firebase connected");

/* ========= ROOM ========= */

const params = new URLSearchParams(location.search);
const room = params.get("room") || Math.random().toString(36).slice(2, 7);
history.replaceState({}, "", "?room=" + room);

const roomRef = db.ref("bingo/" + room);
console.log("Room:", room);

/* ========= STATE ========= */

let myId;
let myBoard = [];
let marked = {};
let winner = null;

const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");

/* ========= UTILS ========= */

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* ========= RENDER ========= */

function renderBoard() {
  boardEl.innerHTML = "";
  myBoard.forEach(n => {
    const d = document.createElement("div");
    d.className = "cell";
    d.textContent = n;
    if (marked[n]) d.classList.add("marked");
    d.onclick = () => markNumber(n);
    boardEl.appendChild(d);
  });
}

/* ========= JOIN ========= */

roomRef.child("players").once("value", snap => {
  const players = snap.val() || {};
  if (Object.keys(players).length >= 2) {
    statusEl.textContent = "Room full";
    return;
  }

  myId = roomRef.child("players").push(true).key;

  myBoard = shuffle(
    Array.from({ length: 25 }, (_, i) => i + 1)
  );

  roomRef.child("boards/" + myId).set(myBoard);

  statusEl.textContent = "Game started";
});

/* ========= SYNC ========= */

roomRef.on("value", snap => {
  const data = snap.val();
  if (!data) return;

  marked = data.marked || {};
  winner = data.winner || null;

  renderBoard();

  if (winner) {
    statusEl.textContent =
      winner === myId ? "You won ðŸŽ‰" : "You lost ðŸ˜”";
  }
});

/* ========= GAME ========= */

function markNumber(n) {
  if (winner || marked[n]) return;

  marked[n] = true;
  roomRef.update({ marked });

  if (checkBingo() >= 5) {
    roomRef.update({ winner: myId });
  }
}

function checkBingo() {
  const m = i => marked[myBoard[i]];

  const lines = [
    [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],
    [15,16,17,18,19],[20,21,22,23,24],
    [0,5,10,15,20],[1,6,11,16,21],
    [2,7,12,17,22],[3,8,13,18,23],
    [4,9,14,19,24],
    [0,6,12,18,24],[4,8,12,16,20]
  ];

  return lines.filter(line => line.every(m)).length;
}
</script>
</body>
</html>

