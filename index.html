<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tic Tac Toe Multiplayer</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #111;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .game {
    text-align: center;
  }

  .board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    gap: 10px;
    margin: 20px auto;
  }

  .cell {
    width: 100px;
    height: 100px;
    background: #222;
    font-size: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .cell:hover {
    background: #333;
  }

  .status {
    margin-top: 10px;
  }
</style>
</head>
<body>

<div class="game">
  <h1>Tic Tac Toe</h1>
  <div class="board" id="board"></div>
  <div class="status" id="status">Loadingâ€¦</div>
</div>

<!-- STEP A: VERIFY JS RUNS -->
<script>
  alert("JS LOADED");
  console.log("SCRIPT STARTED");
</script>

<!-- STEP B: FIREBASE SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ===========================
   STEP C: FIREBASE CONFIG
   =========================== */


  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCT6Cu6UCcQzsxUOTHCskTzXCCMsmSDzFU",
  authDomain: "realtime-tic-tac-toe-98cfc.firebaseapp.com",
  projectId: "realtime-tic-tac-toe-98cfc",
  storageBucket: "realtime-tic-tac-toe-98cfc.firebasestorage.app",
  messagingSenderId: "621024160507",
  appId: "1:621024160507:web:0dc7713e199bd4d8d71e5e",
  measurementId: "G-TG3JHTFNXH"
};
  // ðŸ‘‡ PASTE YOUR FIREBASE CONFIG HERE
  // MUST include databaseURL


firebase.initializeApp(firebaseConfig);
console.log("Firebase initialized");

const db = firebase.database();

/* ===========================
   STEP D: CONNECTION CHECK
   =========================== */

firebase.database().ref(".info/connected").on("value", snap => {
  console.log("Firebase connected:", snap.val());
});

/* ===========================
   STEP E: ROOM SETUP
   =========================== */

const params = new URLSearchParams(location.search);
const room = params.get("room") || Math.random().toString(36).slice(2, 7);
history.replaceState({}, "", "?room=" + room);

console.log("Room ID:", room);

const roomRef = db.ref("rooms/" + room);

/* ===========================
   STEP F: GAME STATE
   =========================== */

let mySymbol = null;
let board = Array(9).fill("");
let turn = "X";

const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");

/* ===========================
   STEP G: CREATE BOARD UI
   =========================== */

for (let i = 0; i < 9; i++) {
  const cell = document.createElement("div");
  cell.className = "cell";
  cell.onclick = () => makeMove(i);
  boardEl.appendChild(cell);
}

console.log("Board created");

/* ===========================
   STEP H: JOIN ROOM
   =========================== */

roomRef.child("players").once("value", snap => {
  const players = snap.val() || {};
  const count = Object.keys(players).length;

  console.log("Players in room:", count);

  if (count >= 2) {
    statusEl.textContent = "Room full";
    return;
  }

  mySymbol = count === 0 ? "X" : "O";
  roomRef.child("players").push(mySymbol);

  statusEl.textContent = "You are " + mySymbol;
  console.log("Assigned symbol:", mySymbol);
});

/* ===========================
   STEP I: LISTEN FOR UPDATES
   =========================== */

roomRef.on("value", snap => {
  const data = snap.val();
  if (!data) return;

  board = data.board || board;
  turn = data.turn || turn;

  updateUI();
  console.log("Game updated", data);
});

/* ===========================
   STEP J: MAKE MOVE
   =========================== */

function makeMove(i) {
  console.log("Cell clicked:", i);

  if (!mySymbol) return;
  if (board[i] !== "") return;
  if (turn !== mySymbol) return;

  board[i] = mySymbol;
  turn = mySymbol === "X" ? "O" : "X";

  roomRef.update({ board, turn });
}

/* ===========================
   STEP K: UPDATE UI
   =========================== */

function updateUI() {
  [...boardEl.children].forEach((c, i) => {
    c.textContent = board[i];
  });

  statusEl.textContent =
    turn === mySymbol ? "Your turn" : "Opponent's turn";
}
</script>

</body>
</html>


